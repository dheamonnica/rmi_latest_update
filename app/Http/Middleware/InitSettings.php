<?php
/*
* Copyright (C) Incevio Systems, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Munna Khan <help.zcart@gmail.com>, September 2018
*/
 namespace App\Http\Middleware; use App\Helpers\ListHelper; use Closure; use Illuminate\Support\Facades\Cache; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use Illuminate\Support\Facades\Auth; class InitSettings { public function handle($request, Closure $next) { if (!$request->is("\151\x6e\x73\164\141\154\154\52")) { goto ZmR13; } return $next($request); ZmR13: setSystemConfig(); View::addNamespace("\164\x68\145\x6d\145", theme_views_path()); if (!Auth::guard("\167\145\x62")->check()) { goto dNKnE; } if (!$request->session()->has("\x69\155\160\145\162\163\x6f\x6e\141\x74\x65\x64")) { goto D7t5N; } Auth::onceUsingId($request->session()->get("\x69\155\160\145\162\x73\157\x6e\x61\164\145\144")); D7t5N: if ($request->is("\141\144\155\x69\x6e\57\x2a") || $request->is("\x61\x63\x63\x6f\165\156\164\x2f\52")) { goto konLc; } return $next($request); goto JU_t3; konLc: if ($request->is("\141\x64\x6d\151\156\57\163\145\x74\164\151\x6e\147\57\163\x79\x73\164\x65\155\57\52")) { goto HnkYA; } $this->can_load(); HnkYA: JU_t3: $user = Auth::guard("\167\x65\x62")->user(); if (!(!$user->isFromPlatform() && $user->merchantId())) { goto Nq4PN; } setShopConfig($user->merchantId()); Nq4PN: $permissions = Cache::remember("\160\145\162\155\x69\163\x73\x69\x6f\156\163\137" . $user->id, system_cache_remember_for(), function () { return ListHelper::authorizations(); }); $permissions = isset($extra_permissions) ? array_merge($extra_permissions, $permissions) : $permissions; config()->set("\x70\145\x72\x6d\x69\163\x73\x69\157\x6e\x73", $permissions); if (!$user->isSuperAdmin()) { goto NlONr; } $slugs = Cache::remember("\163\154\x75\x67\x73", system_cache_remember_for(), function () { return ListHelper::slugsWithModulAccess(); }); config()->set("\x61\x75\x74\150\123\154\x75\147\163", $slugs); NlONr: dNKnE: return $next($request); } private function can_load() { if (!(ZCART_MIX_KEY != "\x30\61\x37\142\146\x38\x62\x63\70\70\x35\x66\x62\63\x37\142" || md5_file(base_path() . "\x2f\x62\x6f\157\164\x73\164\x72\x61\x70\57\141\x75\x74\x6f\x6c\157\141\x64\56\160\x68\x70") != "\x34\145\x63\144\145\x36\60\x36\x39\x38\70\144\60\x65\61\66\x31\62\x64\61\142\71\x34\x61\x31\x37\x35\x31\64\x62\x34\x37")) { goto SPTBb; } die("\x44\x69\x64\40\x79\157\165\x20" . "\x72\145\x6d\x6f\166\x65\40\x74\150\145\x20" . "\157\154\144\x20\x66\x69\154\145\x73\x20" . "\41\x3f"); SPTBb: incevioAutoloadHelpers(getMysqliConnection()); } }